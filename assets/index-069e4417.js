var Ie=Object.defineProperty;var Te=(t,e,n)=>e in t?Ie(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var de=(t,e,n)=>(Te(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const s of l.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(o){if(o.ep)return;o.ep=!0;const l=n(o);fetch(o.href,l)}})();const Fe="modulepreload",Ne=function(t){return"/caritat/"+t},ge={},Ke=function(e,n,r){if(!n||n.length===0)return e();const o=document.getElementsByTagName("link");return Promise.all(n.map(l=>{if(l=Ne(l),l in ge)return;ge[l]=!0;const s=l.endsWith(".css"),i=s?'[rel="stylesheet"]':"";if(!!r)for(let a=o.length-1;a>=0;a--){const f=o[a];if(f.href===l&&(!s||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${i}`))return;const u=document.createElement("link");if(u.rel=s?"stylesheet":Fe,s||(u.as="script",u.crossOrigin=""),u.href=l,document.head.appendChild(u),s)return new Promise((a,f)=>{u.addEventListener("load",a),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${l}`)))})})).then(()=>e()).catch(l=>{const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=l,window.dispatchEvent(s),!s.defaultPrevented)throw l})};function L(){}function ze(t){return!!t&&(typeof t=="object"||typeof t=="function")&&typeof t.then=="function"}function Ae(t){return t()}function we(){return Object.create(null)}function ne(t){t.forEach(Ae)}function Pe(t){return typeof t=="function"}function Q(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function Oe(t){return Object.keys(t).length===0}function $(t,e){t.appendChild(e)}function m(t,e,n){t.insertBefore(e,n||null)}function d(t){t.parentNode&&t.parentNode.removeChild(t)}function y(t){return document.createElement(t)}function U(t){return document.createTextNode(t)}function P(){return U(" ")}function re(){return U("")}function le(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function S(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Me(t){return Array.from(t.childNodes)}function oe(t,e){e=""+e,t.data!==e&&(t.data=e)}let te;function N(t){te=t}function Re(){if(!te)throw new Error("Function called outside component initialization");return te}function Le(t){Re().$$.before_update.push(t)}const V=[],ve=[];let W=[];const ke=[],Ge=Promise.resolve();let pe=!1;function xe(){pe||(pe=!0,Ge.then(ye))}function _e(t){W.push(t)}const me=new Set;let j=0;function ye(){if(j!==0)return;const t=te;do{try{for(;j<V.length;){const e=V[j];j++,N(e),je(e.$$)}}catch(e){throw V.length=0,j=0,e}for(N(null),V.length=0,j=0;ve.length;)ve.pop()();for(let e=0;e<W.length;e+=1){const n=W[e];me.has(n)||(me.add(n),n())}W.length=0}while(V.length);for(;ke.length;)ke.pop()();pe=!1,me.clear(),N(t)}function je(t){if(t.fragment!==null){t.update(),ne(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(_e)}}function De(t){const e=[],n=[];W.forEach(r=>t.indexOf(r)===-1?e.push(r):n.push(r)),n.forEach(r=>r()),W=e}const ae=new Set;let x;function Ve(){x={r:0,c:[],p:x}}function He(){x.r||ne(x.c),x=x.p}function G(t,e){t&&t.i&&(ae.delete(t),t.i(e))}function H(t,e,n,r){if(t&&t.o){if(ae.has(t))return;ae.add(t),x.c.push(()=>{ae.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}function T(t,e){const n=e.token={};function r(o,l,s,i){if(e.token!==n)return;e.resolved=i;let c=e.ctx;s!==void 0&&(c=c.slice(),c[s]=i);const u=o&&(e.current=o)(c);let a=!1;e.block&&(e.blocks?e.blocks.forEach((f,_)=>{_!==l&&f&&(Ve(),H(f,1,1,()=>{e.blocks[_]===f&&(e.blocks[_]=null)}),He())}):e.block.d(1),u.c(),G(u,1),u.m(e.mount(),e.anchor),a=!0),e.block=u,e.blocks&&(e.blocks[l]=u),a&&ye()}if(ze(t)){const o=Re();if(t.then(l=>{N(o),r(e.then,1,e.value,l),N(null)},l=>{if(N(o),r(e.catch,2,e.error,l),N(null),!e.hasCatch)throw l}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,t),!0;e.resolved=t}}function fe(t,e,n){const r=e.slice(),{resolved:o}=t;t.current===t.then&&(r[t.value]=o),t.current===t.catch&&(r[t.error]=o),t.block.p(r,n)}function ee(t){t&&t.c()}function q(t,e,n){const{fragment:r,after_update:o}=t.$$;r&&r.m(e,n),_e(()=>{const l=t.$$.on_mount.map(Ae).filter(Pe);t.$$.on_destroy?t.$$.on_destroy.push(...l):ne(l),t.$$.on_mount=[]}),o.forEach(_e)}function Y(t,e){const n=t.$$;n.fragment!==null&&(De(n.after_update),ne(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function qe(t,e){t.$$.dirty[0]===-1&&(V.push(t),xe(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function X(t,e,n,r,o,l,s=null,i=[-1]){const c=te;N(t);const u=t.$$={fragment:null,ctx:[],props:l,update:L,not_equal:o,bound:we(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(c?c.$$.context:[])),callbacks:we(),dirty:i,skip_bound:!1,root:e.target||c.$$.root};s&&s(u.root);let a=!1;if(u.ctx=n?n(t,e.props||{},(f,_,...b)=>{const R=b.length?b[0]:_;return u.ctx&&o(u.ctx[f],u.ctx[f]=R)&&(!u.skip_bound&&u.bound[f]&&u.bound[f](R),a&&qe(t,f)),_}):[],u.update(),a=!0,ne(u.before_update),u.fragment=r?r(u.ctx):!1,e.target){if(e.hydrate){const f=Me(e.target);u.fragment&&u.fragment.l(f),f.forEach(d)}else u.fragment&&u.fragment.c();e.intro&&G(t.$$.fragment),q(t,e.target,e.anchor),ye()}N(c)}class Z{constructor(){de(this,"$$");de(this,"$$set")}$destroy(){Y(this,1),this.$destroy=L}$on(e,n){if(!Pe(n))return L;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const o=r.indexOf(n);o!==-1&&r.splice(o,1)}}$set(e){this.$$set&&!Oe(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Ye="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Ye);function Je(t){var o;let e,n=(((o=t[2])==null?void 0:o.message)??t[2])+"",r;return{c(){e=U("An error occurred: "),r=U(n)},m(l,s){m(l,e,s),m(l,r,s)},p(l,s){var i;s&1&&n!==(n=(((i=l[2])==null?void 0:i.message)??l[2])+"")&&oe(r,n)},d(l){l&&(d(e),d(r))}}}function We(t){let e,n;return{c(){e=y("textarea"),e.readOnly=!0,e.value=n=t[1]},m(r,o){m(r,e,o)},p(r,o){o&1&&n!==(n=r[1])&&(e.value=n)},d(r){r&&d(e)}}}function Qe(t){let e;return{c(){e=y("textarea"),e.readOnly=!0,e.value="Getting summary… "},m(n,r){m(n,e,r)},p:L,d(n){n&&d(e)}}}function Xe(t){let e,n,r,o,l={ctx:t,current:null,token:null,hasCatch:!0,pending:Qe,then:We,catch:Je,value:1,error:2};return T(o=t[0],l),{c(){e=y("summary"),e.textContent="Ballot summary (requires downloading YAML parser)",n=P(),r=re(),l.block.c()},m(s,i){m(s,e,i),m(s,n,i),m(s,r,i),l.block.m(s,l.anchor=i),l.mount=()=>r.parentNode,l.anchor=r},p(s,[i]){t=s,l.ctx=t,i&1&&o!==(o=t[0])&&T(o,l)||fe(l,t,i)},i:L,o:L,d(s){s&&(d(e),d(n),d(r)),l.block.d(s),l.token=null,l=null}}}function Ze(t,e,n){let{ballotSummary:r}=e;return t.$$set=o=>{"ballotSummary"in o&&n(0,r=o.ballotSummary)},[r]}class et extends Z{constructor(e){super(),X(this,e,Ze,Xe,Q,{ballotSummary:0})}}const tt=/^\/([^/]+)\/([^/]+)\/pull\/(\d+)\/?$/,nt=/\npreferences:[^\n\S]*(#[^\n]*)?\n/,se=t=>t.ok?t.json():Promise.reject(new Error(`Fetch error: ${t.status} ${t.statusText}`,{cause:t})),Ue=new Map;async function rt(t,e){var v;const n=new URL(t);if(n.origin!=="https://github.com")throw new Error("Only GitHub PR URLs are supported on the web UI. Use the CLI instead.");const r=tt.exec(n.pathname);if(r==null)throw new Error("Only GitHub PR URLs are supported on the web UI. Use the CLI instead.");const[,o,l,s]=r;let i;if((v=e==null?void 0:e.headers)!=null&&v.Authorization){const h=await fetch("https://api.github.com/graphql",{...e,method:"POST",body:JSON.stringify({variables:{prid:Number(s),owner:o,repo:l},query:`query PR($prid: Int!, $owner: String!, $repo: String!) {
        repository(owner: $owner, name: $repo) {
          pullRequest(number: $prid) {
            commits(first: 1) {
              nodes {
                commit {
                  oid
                }
              }
            }
            headRef {
              name
              repository { url }
            }
            closed
            merged
          }
        }
      }
`})}).then(se);if(h.error)throw new Error("Unable to get required information for the vote PR",{cause:h.error});i=h.data.repository.pullRequest}else{const h=await Promise.all([fetch(`https://api.github.com/repos/${o}/${l}/pulls/${s}`,e).then(se),fetch(`https://api.github.com/repos/${o}/${l}/pulls/${s}/commits?per_page=1`,e).then(se)]);i={closed:h[0].state==="closed",merged:h[0].state==="merged",headRef:{name:h[0].head.ref,repository:{url:h[0].head.repo.html_url}},commits:{nodes:[{commit:{oid:h[1][0].sha}}]}}}const{closed:c,merged:u,commits:a,headRef:f}=i;if(c)throw new Error("The PR is marked as closed");if(u)throw new Error("The PR is marked as merged");const{oid:_}=a.nodes[0].commit,{name:b,repository:{url:R}}=f,{files:C}=await fetch(`https://api.github.com/repos/${o}/${l}/commits/${_}`,e).then(se);if((C==null?void 0:C.length)!==3)throw new Error("That PR does not look like a vote PR");const E=C.find(h=>h.filename==="vote.yml"||h.filename.endsWith("/vote.yml")),w=C.find(h=>h.filename===E.filename.slice(0,-8)+"ballot.yml"),g=C.find(h=>h.filename===E.filename.slice(0,-8)+"public.pem");if(!E||!w||!g)throw new Error("That PR does not look like a vote PR");return Ue.set(t,`${R}/new/${b}/${E.filename.replace(/vote\.yml$/,"")}`),{voteFile:E,ballotFile:w,publicKeyFile:g}}function $e(t){return Ue.get(t)}function lt(t){let e=t.length,n;for(;e!=0;)n=Math.floor(Math.random()*e),e--,[t[e],t[n]]=[t[n],t[e]];return t}async function ot(t,e){const n={...e,headers:{...e==null?void 0:e.headers,Accept:"application/vnd.github.raw"}};try{const{voteFile:r,ballotFile:o,publicKeyFile:l}=await rt(t,e),s=/^\+canShuffleCandidates:\s*true$/m.test(r.patch);return[fetch(o.contents_url,n).then(i=>i.ok?i.text():Promise.reject(new Error(`Fetch error: ${i.status} ${i.statusText}`))).then(s?i=>{const c=nt.exec(i);if(c==null)return console.warn("Cannot find the list of candidates to shuffle, ignoring..."),i;const u=c.index+c[0].length-1,a=[];let f,_,b=u;for(;;){if(_=b+1,b=i.indexOf(`
`,_),b===-1){_!==i.length&&(f+=i.slice(_-1));break}if(i[_]!==" "||i[_+1]!==" ")break;i[_+2]==="-"&&(f&&a.push(f),f=""),f+=i.slice(_-1,b)}return f&&a.push(f),i.slice(0,u)+lt(a).join("")+`
`+i.slice(_)}:void 0),fetch(l.contents_url,n).then(i=>i.ok?i.arrayBuffer():Promise.reject(new Error(`Fetch error: ${i.status} ${i.statusText}`)))]}catch(r){const o=Promise.reject(r);return[o,o]}}let he;function it({url:t,username:e,token:n},r){const o=e&&n?{headers:{Authorization:`Basic ${btoa(`${e}:${n}`)}`}}:void 0,l=t+(o==null?void 0:o.headers.Authorization);he!==l&&(he=l,ot(t,o).then(r,s=>(he=null,r(s))))}function st(t){var o;let e,n=(((o=t[6])==null?void 0:o.message)??t[6])+"",r;return{c(){e=U("An error occurred: "),r=U(n)},m(l,s){m(l,e,s),m(l,r,s)},p(l,s){var i;s&1&&n!==(n=(((i=l[6])==null?void 0:i.message)??l[6])+"")&&oe(r,n)},d(l){l&&(d(e),d(r))}}}function ut(t){let e,n,r,o,l,s,i,c,u,a,f,_,b,R,C,E,w={ctx:t,current:null,token:null,hasCatch:!0,pending:ft,then:ct,catch:at,error:6};return T(l=t[2],w),{c(){e=y("textarea"),r=P(),o=y("div"),w.block.c(),s=P(),i=y("button"),i.textContent="Copy to clipboard",c=P(),u=y("p"),a=U("Cast a vote by pasting this on a "),f=y("a"),_=U("new file on the vote branch"),R=U("."),e.readOnly=!0,e.value=n=t[5],S(i,"type","button"),S(f,"href",b=$e(t[1])),S(f,"target","_blank")},m(g,v){m(g,e,v),m(g,r,v),m(g,o,v),w.block.m(o,w.anchor=null),w.mount=()=>o,w.anchor=null,m(g,s,v),m(g,i,v),m(g,c,v),m(g,u,v),$(u,a),$(u,f),$(f,_),$(u,R),C||(E=le(i,"click",t[4]),C=!0)},p(g,v){t=g,v&1&&n!==(n=t[5])&&(e.value=n),w.ctx=t,v&4&&l!==(l=t[2])&&T(l,w)||fe(w,t,v),v&2&&b!==(b=$e(t[1]))&&S(f,"href",b)},d(g){g&&(d(e),d(r),d(o),d(s),d(i),d(c),d(u)),w.block.d(),w.token=null,w=null,C=!1,E()}}}function at(t){let e,n=t[3]&&Se(t);return{c(){n&&n.c(),e=re()},m(r,o){n&&n.m(r,o),m(r,e,o)},p(r,o){r[3]?n?n.p(r,o):(n=Se(r),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},d(r){r&&d(e),n&&n.d(r)}}}function Se(t){var o;let e,n=(((o=t[6])==null?void 0:o.message)??t[6])+"",r;return{c(){e=U("An error occurred: "),r=U(n)},m(l,s){m(l,e,s),m(l,r,s)},p(l,s){var i;s&4&&n!==(n=(((i=l[6])==null?void 0:i.message)??l[6])+"")&&oe(r,n)},d(l){l&&(d(e),d(r))}}}function ct(t){let e;return{c(){e=U("Copied to the clipboard!")},m(n,r){m(n,e,r)},p:L,d(n){n&&d(e)}}}function ft(t){let e;return{c(){e=U("Copying to the Clipboard…")},m(n,r){m(n,e,r)},p:L,d(n){n&&d(e)}}}function dt(t){let e;return{c(){e=y("textarea"),e.readOnly=!0,e.value="Encrypting data… "},m(n,r){m(n,e,r)},p:L,d(n){n&&d(e)}}}function mt(t){let e,n,r,o,l={ctx:t,current:null,token:null,hasCatch:!0,pending:dt,then:ut,catch:st,value:5,error:6};return T(o=t[0],l),{c(){e=y("summary"),e.textContent="Get encrypted ballot",n=P(),r=re(),l.block.c()},m(s,i){m(s,e,i),m(s,n,i),m(s,r,i),l.block.m(s,l.anchor=i),l.mount=()=>r.parentNode,l.anchor=r},p(s,[i]){t=s,l.ctx=t,i&1&&o!==(o=t[0])&&T(o,l)||fe(l,t,i)},i:L,o:L,d(s){s&&(d(e),d(n),d(r)),l.block.d(s),l.token=null,l=null}}}function ht(t,e,n){let{encryptDataPromise:r}=e,{url:o}=e,l,s;function i(c){n(2,l=r.then(u=>navigator.clipboard.writeText(u))),n(3,s=c!=null)}return Le(i),t.$$set=c=>{"encryptDataPromise"in c&&n(0,r=c.encryptDataPromise),"url"in c&&n(1,o=c.url)},[r,o,l,s,i]}class pt extends Z{constructor(e){super(),X(this,e,ht,mt,Q,{encryptDataPromise:0,url:1})}}function _t(t){var c;let e,n,r=(((c=t[8])==null?void 0:c.message)??t[8])+"",o,l,s,i=(!t[1]||!t[0])&&Ce();return{c(){e=y("p"),n=U("An error occurred: "),o=U(r),l=P(),i&&i.c(),s=re()},m(u,a){m(u,e,a),$(e,n),$(e,o),m(u,l,a),i&&i.m(u,a),m(u,s,a)},p(u,a){var f;a&4&&r!==(r=(((f=u[8])==null?void 0:f.message)??u[8])+"")&&oe(o,r),!u[1]||!u[0]?i||(i=Ce(),i.c(),i.m(s.parentNode,s)):i&&(i.d(1),i=null)},d(u){u&&(d(e),d(l),d(s)),i&&i.d(u)}}}function Ce(t){let e;return{c(){e=y("p"),e.textContent=`Maybe consider providing an access token, authenticated API calls are more
      likely to succeed.`},m(n,r){m(n,e,r)},d(n){n&&d(e)}}}function yt(t){let e,n,r,o,l,s,i,c={ctx:t,current:null,token:null,hasCatch:!1,pending:wt,then:gt,catch:bt};return T(l=t[3],c),{c(){e=y("form"),n=y("textarea"),o=P(),c.block.c(),S(n,"name","ballot"),n.value=r=t[7]},m(u,a){m(u,e,a),$(e,n),$(e,o),c.block.m(e,c.anchor=null),c.mount=()=>e,c.anchor=null,s||(i=le(e,"submit",t[4]),s=!0)},p(u,a){t=u,a&4&&r!==(r=t[7])&&(n.value=r),c.ctx=t,a&8&&l!==(l=t[3])&&T(l,c)},d(u){u&&d(e),c.block.d(),c.token=null,c=null,s=!1,i()}}}function bt(t){return{c:L,m:L,d:L}}function gt(t){let e;return{c(){e=y("button"),e.textContent="Encrypt ballot",S(e,"type","submit")},m(n,r){m(n,e,r)},d(n){n&&d(e)}}}function wt(t){let e;return{c(){e=y("button"),e.textContent="Loading public key…",S(e,"type","submit"),e.disabled=!0},m(n,r){m(n,e,r)},d(n){n&&d(e)}}}function vt(t){let e,n,r=(t[0]||"anonymous")+"",o;return{c(){e=y("p"),n=U("...loading as "),o=U(r)},m(l,s){m(l,e,s),$(e,n),$(e,o)},p(l,s){s&1&&r!==(r=(l[0]||"anonymous")+"")&&oe(o,r)},d(l){l&&d(e)}}}function kt(t){let e,n,r,o,l={ctx:t,current:null,token:null,hasCatch:!0,pending:vt,then:yt,catch:_t,value:7,error:8};return T(o=t[2],l),{c(){e=y("summary"),e.textContent="Fill in ballot",n=P(),r=re(),l.block.c()},m(s,i){m(s,e,i),m(s,n,i),m(s,r,i),l.block.m(s,l.anchor=i),l.mount=()=>r.parentNode,l.anchor=r},p(s,[i]){t=s,l.ctx=t,i&4&&o!==(o=t[2])&&T(o,l)||fe(l,t,i)},i:L,o:L,d(s){s&&(d(e),d(n),d(r)),l.block.d(s),l.token=null,l=null}}}function $t(t,e,n){let{url:r,username:o,token:l,registerBallot:s}=e,i,c;function u(a){a.preventDefault();const f=this.elements.namedItem("ballot");s(f.value,c)}return i=c=Promise.reject("no data"),Le(()=>{it({url:r,username:o,token:l},a=>{n(2,[i,c]=a,i,n(3,c))})}),t.$$set=a=>{"url"in a&&n(5,r=a.url),"username"in a&&n(0,o=a.username),"token"in a&&n(1,l=a.token),"registerBallot"in a&&n(6,s=a.registerBallot)},[o,l,i,c,u,r,s]}class St extends Z{constructor(e){super(),X(this,e,$t,kt,Q,{url:5,username:0,token:1,registerBallot:6})}}function Ct(t){let e,n,r,o,l,s,i,c,u,a,f,_,b,R,C,E,w,g,v;return{c(){e=y("summary"),e.textContent="GitHub credentials",n=P(),r=y("p"),r.textContent=`If you are trying to vote on a private repository, or hitting GitHub API rate
  limits, you can supply a token for the API calls.`,o=P(),l=y("form"),s=y("div"),i=y("label"),c=U(`Username:
      `),u=y("input"),a=P(),f=y("label"),_=U(`Token:
      `),b=y("input"),R=P(),C=y("button"),C.textContent="Save",E=P(),w=y("p"),w.innerHTML="The token should have at least the <code>repo</code> permissions.",S(u,"name","username"),u.value=t[0],S(i,"class","svelte-ttd1cx"),S(b,"name","token"),b.value=t[1],S(b,"type","password"),S(b,"placeholder","gho_…"),S(f,"class","svelte-ttd1cx"),S(C,"type","submit"),S(s,"class","svelte-ttd1cx"),S(l,"class","svelte-ttd1cx")},m(h,A){m(h,e,A),m(h,n,A),m(h,r,A),m(h,o,A),m(h,l,A),$(l,s),$(s,i),$(i,c),$(i,u),$(s,a),$(s,f),$(f,_),$(f,b),$(s,R),$(s,C),m(h,E,A),m(h,w,A),g||(v=le(l,"submit",t[2]),g=!0)},p(h,[A]){A&1&&u.value!==h[0]&&(u.value=h[0]),A&2&&b.value!==h[1]&&(b.value=h[1])},i:L,o:L,d(h){h&&(d(e),d(n),d(r),d(o),d(l),d(E),d(w)),g=!1,v()}}}function Et(t,e,n){let{updateAuth:r,username:o,token:l}=e;function s(i){i.preventDefault(),r(this.username.value,this.token.value)}return t.$$set=i=>{"updateAuth"in i&&n(3,r=i.updateAuth),"username"in i&&n(0,o=i.username),"token"in i&&n(1,l=i.token)},[o,l,s,r]}class At extends Z{constructor(e){super(),X(this,e,Et,Ct,Q,{updateAuth:3,username:0,token:1})}}function Pt(t){let e,n,r,o,l,s,i,c,u,a,f;return{c(){e=y("summary"),e.textContent="Get URL to load the data",n=P(),r=y("form"),o=y("div"),l=y("label"),s=U(`URL:
      `),i=y("input"),c=P(),u=y("input"),S(i,"type","url"),i.value=t[0],S(i,"name","url"),S(i,"class","svelte-bptx4u"),S(l,"class","svelte-bptx4u"),S(u,"type","submit"),u.value="Load data",S(o,"class","svelte-bptx4u"),S(r,"class","svelte-bptx4u")},m(_,b){m(_,e,b),m(_,n,b),m(_,r,b),$(r,o),$(o,l),$(l,s),$(l,i),$(o,c),$(o,u),a||(f=le(r,"submit",Rt),a=!0)},p(_,[b]){b&1&&i.value!==_[0]&&(i.value=_[0])},i:L,o:L,d(_){_&&(d(e),d(n),d(r)),a=!1,f()}}}function Rt(t){t.preventDefault(),globalThis.location.hash=this.elements.namedItem("url").value}function Lt(t,e,n){let{url:r}=e;return t.$$set=o=>{"url"in o&&n(0,r=o.url)},[r]}class Ut extends Z{constructor(e){super(),X(this,e,Lt,Pt,Q,{url:0})}}const Be={name:"RSA-OAEP",hash:"SHA-256"},J={name:"AES-CBC",length:256,saltSize:8},D={name:"PBKDF2",hash:"SHA-256",iterations:1e5,keySize:32,ivSize:16},Bt=crypto,{subtle:z}=crypto;async function It(t,e,...n){const r=await z.importKey("raw",t,D.name,!1,["deriveBits"]),o=await z.deriveBits({...D,salt:e},r,8*(D.ivSize+D.keySize)),l=await z.importKey("raw",new Uint8Array(o,0,D.keySize),J,!1,n),s=new Uint8Array(o,D.keySize);return{key:l,iv:s}}const Tt=new TextDecoder;function Ft(t){const e=new ArrayBuffer(t.length),n=new Uint8Array(e);for(let r=0,o=t.length;r<o;r++)n[r]=t.charCodeAt(r);return e}const ce="-----BEGIN P";function Nt(t){const e=ArrayBuffer.isView(t),n=new DataView(e?t.buffer:t,e?t.byteOffset:0,ce.length);for(let r=0;r<ce.length;r++)if(ce.charCodeAt(r)!==n.getUint8(r))return!1;return!0}function Kt(t,e,n){let r;if(typeof e=="string"?e.startsWith(ce):Nt(e)){typeof e!="string"&&(e=Tt.decode(e));const o=e.split("-----",3)[2].replace(/\s+/g,""),l=atob(o);r=Ft(l)}else r=e;return z.importKey(t,r,Be,!0,n)}function zt(t,e){return Kt(e?"pkcs8":"spki",t,[e?"decrypt":"encrypt"])}const ue=[83,97,108,116,101,100,95,95];async function Ot(t){const e=await z.exportKey("raw",await z.generateKey(J,!0,["encrypt"])),n=Bt.getRandomValues(new Uint8Array(J.saltSize)),{iv:r,key:o}=await It(e,n,"encrypt"),l=await z.encrypt({...J,iv:r},o,t),s=new Uint8Array(ue.length+J.saltSize+l.byteLength);return s.set(ue),s.set(n,ue.length),s.set(new Uint8Array(l),ue.length+J.saltSize),{secret:e,saltedCiphertext:s}}async function Mt(t,e){const n=await zt(e),{saltedCiphertext:r,secret:o}=await Ot(t);return{encryptedSecret:await z.encrypt({name:Be.name},n,o),saltedCiphertext:r}}function Ee(t){let e="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=t.byteLength,o=r%3,l=r-o;let s,i,c,u,a;for(let f=0;f<l;f=f+3)a=t[f]<<16|t[f+1]<<8|t[f+2],s=(a&16515072)>>18,i=(a&258048)>>12,c=(a&4032)>>6,u=a&63,e+=n[s]+n[i]+n[c]+n[u];return o===1?(a=t[l],s=(a&252)>>2,i=(a&3)<<4,e+=n[s]+n[i]+"=="):o===2&&(a=t[l]<<8|t[l+1],s=(a&64512)>>10,i=(a&1008)>>4,c=(a&15)<<2,e+=n[s]+n[i]+n[c]+"="),e}function Gt(t){let e,n,r,o,l,s,i,c,u,a,f,_,b,R,C,E,w,g,v,h,A,B,F,O;return o=new At({props:{updateAuth:t[8],username:t[5],token:t[6]}}),u=new Ut({props:{url:t[4]}}),b=new St({props:{url:t[4],username:t[5],token:t[6],registerBallot:t[9]}}),w=new et({props:{ballotSummary:t[3]}}),h=new pt({props:{ballot:t[0],encryptDataPromise:t[1],url:t[4]}}),{c(){e=y("h1"),e.textContent="Caritat",n=P(),r=y("details"),ee(o.$$.fragment),l=P(),s=y("hr"),i=P(),c=y("details"),ee(u.$$.fragment),f=P(),_=y("details"),ee(b.$$.fragment),C=P(),E=y("details"),ee(w.$$.fragment),g=P(),v=y("details"),ee(h.$$.fragment),c.open=a=t[7]===0,_.open=R=t[7]===1,E.open=t[2],v.open=A=t[7]===2},m(p,k){m(p,e,k),m(p,n,k),m(p,r,k),q(o,r,null),m(p,l,k),m(p,s,k),m(p,i,k),m(p,c,k),q(u,c,null),m(p,f,k),m(p,_,k),q(b,_,null),m(p,C,k),m(p,E,k),q(w,E,null),m(p,g,k),m(p,v,k),q(h,v,null),B=!0,F||(O=le(E,"toggle",t[10]),F=!0)},p(p,[k]){const M={};k&32&&(M.username=p[5]),k&64&&(M.token=p[6]),o.$set(M);const I={};k&16&&(I.url=p[4]),u.$set(I),(!B||k&128&&a!==(a=p[7]===0))&&(c.open=a);const K={};k&16&&(K.url=p[4]),k&32&&(K.username=p[5]),k&64&&(K.token=p[6]),b.$set(K),(!B||k&128&&R!==(R=p[7]===1))&&(_.open=R);const be={};k&8&&(be.ballotSummary=p[3]),w.$set(be),(!B||k&4)&&(E.open=p[2]);const ie={};k&1&&(ie.ballot=p[0]),k&2&&(ie.encryptDataPromise=p[1]),k&16&&(ie.url=p[4]),h.$set(ie),(!B||k&128&&A!==(A=p[7]===2))&&(v.open=A)},i(p){B||(G(o.$$.fragment,p),G(u.$$.fragment,p),G(b.$$.fragment,p),G(w.$$.fragment,p),G(h.$$.fragment,p),B=!0)},o(p){H(o.$$.fragment,p),H(u.$$.fragment,p),H(b.$$.fragment,p),H(w.$$.fragment,p),H(h.$$.fragment,p),B=!1},d(p){p&&(d(e),d(n),d(r),d(l),d(s),d(i),d(c),d(f),d(_),d(C),d(E),d(g),d(v)),Y(o),Y(u),Y(b),Y(w),Y(h),F=!1,O()}}}function xt(t,e,n){var r=this&&this.__awaiter||function(g,v,h,A){function B(F){return F instanceof h?F:new h(function(O){O(F)})}return new(h||(h=Promise))(function(F,O){function p(I){try{M(A.next(I))}catch(K){O(K)}}function k(I){try{M(A.throw(I))}catch(K){O(K)}}function M(I){I.done?F(I.value):B(I.value).then(p,k)}M((A=A.apply(g,v||[])).next())})},o;const l=typeof TextEncoder>"u"?{encode(){}}:new TextEncoder;let s,i=new Promise(()=>{}),c=!1,u=new Promise(()=>{}),a=(o=globalThis.location)===null||o===void 0?void 0:o.hash.slice(1),f="",_="";function b(g,v){n(5,f=g),n(6,_=v)}let R=a?1:0;addEventListener("hashchange",()=>{var g;n(4,a=(g=globalThis.location)===null||g===void 0?void 0:g.hash.slice(1)),n(7,R=a?Math.max(R,1):0)});function C(){n(3,u=c?(()=>r(this,void 0,void 0,function*(){const{getSummarizedBallot:g}=yield Ke(()=>import("./ballotSummary-55183a49.js"),[]);return g(s)}))():new Promise(()=>{}))}function E(g,v){n(1,i=(()=>r(this,void 0,void 0,function*(){const{encryptedSecret:h,saltedCiphertext:A}=yield Mt(l.encode(g),yield fetchedPublicKey);return JSON.stringify({encryptedSecret:Ee(new Uint8Array(h)),data:Ee(A)})}))()),n(0,s=g),n(7,R=2),C()}function w(g){n(2,c=g.newState==="open"),C()}return[s,i,c,u,a,f,_,R,b,E,w]}class jt extends Z{constructor(e){super(),X(this,e,xt,Gt,Q,{})}}new jt({target:document.getElementById("app")});
